@extends('layouts.app')

@section('head')
	<script src="https://cdn.ckeditor.com/ckeditor5/33.0.0/decoupled-document/ckeditor.js"></script>
@endsection

@section('title')
Administration - Settings
@endsection

@section('content')
	    <div class="row justify-content-center">
	        <div class="col-sm">
	            <div class="card">
	                <div class="card-header">Front Page Content Sections</div>
	
	                <div class="card-body">
						{!!Form::open(array('route'=>'editContent','id'=>'content_form'))!!}
		                <div class="row">
			                <div class="col-sm mb-3">
								<label for="fp_correspondence">Correspondence Courses:</label>
								{!! Form::hidden('fp_correspondence',$settings['editor']->fp_correspondence,['id'=>'fp_correspondence']) !!}
								<div id="fp_correspondence_toolbar"></div>
								<div id="fp_correspondence_content">
									{!! $settings['editor']->fp_correspondence !!}
								</div>
							</div>
			                <div class="col-sm mb-3">
								<label for="fp_online">Online Courses:</label>
								{!! Form::hidden('fp_online',$settings['editor']->fp_online,['id'=>'fp_online']) !!}
								<div id="fp_online_toolbar"></div>
								<div id="fp_online_content">
									{!! $settings['editor']->fp_online !!}
								</div>
							</div>
						</div>
		                <div class="row">
			                <div class="col-sm mb-3">
								<label for="fp_correspondence">Trade Courses:</label>
								{!! Form::hidden('fp_trade',$settings['editor']->fp_trade,['id'=>'fp_trade']) !!}
								<div id="fp_trade_toolbar"></div>
								<div id="fp_trade_content">
									{!! $settings['editor']->fp_trade !!}
								</div>
							</div>
			                <div class="col-sm mb-3"</div>
								<label for="fp_training">Training Courses:</label>
								{!! Form::hidden('fp_training',$settings['editor']->fp_training,['id'=>'fp_training']) !!}
								<div id="fp_training_toolbar"></div>
								<div id="fp_training_content">
									{!! $settings['editor']->fp_training !!}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm mb-3">
								<label for="fp_event">Events:</label>
								{!! Form::hidden('fp_event',$settings['editor']->fp_event,['id'=>'fp_event']) !!}
								<div id="fp_event_toolbar"></div>
								<div id="fp_event_content">
									{!! $settings['editor']->fp_event !!}
								</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Save Content',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
	                </div>
	            </div>
	        </div>
	    </div>
	    <p>&nbsp;</p>
	    <p>&nbsp;</p>
	    <div class="row justify-content-center">
	        <div class="col-sm">
	            <div class="card">
	                <div class="card-header">Registration Status</div>
	
	                <div class="card-body">
						{!!Form::open(array('route'=>'registrationStatus'))!!}
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
									<p><strong>Correspondence Class Registration</strong></p>
									{!!Form::radio('correspondenceregistration','true',($settings['status']->correspondenceregistration)?true:false)!!} Open<br>
									{!!Form::radio('correspondenceregistration','false',($settings['status']->correspondenceregistration)?false:true)!!} Closed<br><br>
									<label for='correspondencemessage'>Closed Message:</label>
									{!!Form::textarea('correspondencemessage',$settings['status']->correspondencemessage,['class'=>'form-control'])!!}
								</div>
							</div>
							<div class="col-sm">
								<div class="form-group">
									<p><strong>Online Registration</strong></p>
									{!!Form::radio('onlineregistration','true',($settings['status']->onlineregistration)?true:false)!!} Open<br>
									{!!Form::radio('onlineregistration','false',($settings['status']->onlineregistration)?false:true)!!} Closed<br><br>
									<label for='onlinemessage'>Closed Message:</label>
									{!!Form::textarea('onlinemessage',$settings['status']->onlinemessage,['class'=>'form-control'])!!}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
									<p><strong>Trade Class Registration</strong></p>
									{!!Form::radio('traderegistration','true',($settings['status']->traderegistration)?true:false)!!} Open<br>
									{!!Form::radio('traderegistration','false',($settings['status']->traderegistration)?false:true)!!} Closed<br><br>
									<label for='trademessage'>Closed Message:</label>
									{!!Form::textarea('trademessage',$settings['status']->trademessage,['class'=>'form-control'])!!}
								</div>
							</div>
							<div class="col-sm">
								<div class="form-group">
									<p><strong>Training Registration</strong></p>
									{!!Form::radio('trainingregistration','true',($settings['status']->trainingregistration)?true:false)!!} Open<br>
									{!!Form::radio('trainingregistration','false',($settings['status']->trainingregistration)?false:true)!!} Closed<br><br>
									<label for='trainingmessage'>Closed Message:</label>
									{!!Form::textarea('trainingmessage',$settings['status']->trainingmessage,['class'=>'form-control'])!!}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
								<p><strong>Event Registration</strong></p>
								{!!Form::radio('eventregistration','true',($settings['status']->eventregistration)?true:false)!!} Open<br>
								{!!Form::radio('eventregistration','false',($settings['status']->eventregistration)?false:true)!!} Closed<br><br>
								<label for='eventmessage'>Closed Message:</label>
								{!!Form::textarea('eventmessage',$settings['status']->eventmessage,['class'=>'form-control'])!!}
							</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
	                </div>
	            </div>
	        </div>
	    </div>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header">Registration Confirmation Email</div>
		
					<div class="card-body">
						<p>Shown in the confirmation email when a registrant completes a registration.</p>
						{!!Form::open(array('route'=>'confirmationEmail','id'=>'confirmationEmail_form'))!!}
						<div class="row">
							<div class="col-sm">
								<h3>Trade Confirmation</h3>
								<div class="form-group">
								{!! Form::hidden('tradeConfirmation',$settings['editor']->tradeconfirmation,['id'=>'tradeConfirmation']) !!}
								<div id="tradeConfirmation_toolbar"></div>
								<div id="tradeConfirmation_content">
									{!! $settings['editor']->tradeconfirmation !!}
								</div>
								</div>
							</div>
							<div class="col-sm">
								<h3>Correspondence Confirmation</h3>
								<div class="form-group">
								{!! Form::hidden('correspondenceConfirmation',$settings['editor']->correspondenceconfirmation,['id'=>'correspondenceConfirmation']) !!}
								<div id="correspondenceConfirmation_toolbar"></div>
								<div id="correspondenceConfirmation_content">
									{!! $settings['editor']->correspondenceconfirmation !!}
								</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm">
								<h3>Training Confirmation</h3>
								<div class="form-group">
								{!! Form::hidden('trainingConfirmation',$settings['editor']->trainingconfirmation,['id'=>'trainingConfirmation']) !!}
								<div id="trainingConfirmation_toolbar"></div>
								<div id="trainingConfirmation_content">
									{!! $settings['editor']->trainingconfirmation !!}
								</div>
								</div>
							</div>
							<div class="col-sm">
								<h3>Online Confirmation</h3>
								<div class="form-group">
								{!! Form::hidden('onlineConfirmation',$settings['editor']->onlineconfirmation,['id'=>'onlineConfirmation']) !!}
								<div id="onlineConfirmation_toolbar"></div>
								<div id="onlineConfirmation_content">
									{!! $settings['editor']->onlineconfirmation !!}
								</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm">
								<h3>Event Confirmation</h3>
								<div class="form-group">
								{!! Form::hidden('eventConfirmation',$settings['editor']->eventconfirmation,['id'=>'eventConfirmation']) !!}
								<div id="eventConfirmation_toolbar"></div>
								<div id="eventConfirmation_content">
									{!! $settings['editor']->eventconfirmation !!}
								</div>
								</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
					</div>
				</div>
			</div>
		</div>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header">Payment Agreement</div>
		
					<div class="card-body">
						<p>Shown in a popup when a registrant chooses check or invoice payment.</p>
						{!!Form::open(array('route'=>'paymentAgree','id'=>'paymentAgree_form'))!!}
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
								{!! Form::hidden('paymentAgree',$settings['editor']->paymentAgree,['id'=>'paymentAgree']) !!}
								<div id="paymentAgree_toolbar"></div>
								<div id="paymentAgree_content">
									{!! $settings['editor']->paymentAgree !!}
									{{--{!! html_entity_decode($paymentAgree) !!}--}}
								</div>
								</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
					</div>
				</div>
			</div>
		</div>
	    <p>&nbsp;</p>
	    <p>&nbsp;</p>
	    <div class="row justify-content-center">
	        <div class="col-sm">
	            <div class="card">
	                <div class="card-header">Trade Agreement Checkboxes</div>
	
	                <div class="card-body">
						{!!Form::open(array('route'=>'registrationTradeAgree'))!!}
						<div class="row">
							<div class="col-sm">
								<p>Add an agreement checkbox when a specific trade is chosen during registration.  The trade name must exactly match those in the registration dropdown.</p>
								<div class="form-group">
									<label for='trade'>Trade:</label>
									{!!Form::text('trade',old('trade'),['class'=>'form-control'])!!}
								</div>
								<div class="form-group">
									<label for='cbmessage'>Checkbox Content:</label>
									{!!Form::textarea('message',old('message'),['class'=>'form-control'])!!}
								</div>
							</div>
							<div class="col-sm">
								<table class="table table-striped table-bordered">
									<tbody>
										@foreach($settings['agreement'] as $key=>$agreement)
											<?php $key = str_replace('t_','',$key); ?>
											<tr><td width="10%"><a href="{{route('registrationTradeAgreeRemove',$key)}}"><i class="far fa-trash-alt"></i></a></td>
											<td width="20%">{{$key}}</td>
											<td width="*">{!!$agreement!!}</td>
											</tr>
										@endforeach
									</tbody>
								</table>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
	                </div>
	            </div>
	        </div>
	    </div>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header">Events/Training Classes</div>
		
					<div class="card-body">
						<p><strong>Check items to mark as an event only:</strong></p>
						{!!Form::open(array('route'=>'eventsMark'))!!}
						<div style="max-height:250px; border:1px solid #999; overflow-y:auto;" class="p-2 mb-1">
							<div class="row">
								@foreach($eventlist as $key=>$event)
								<div class="col-sm-4">
									{!!Form::checkbox('events[]',$key,(isset($eventitems[$key]))?true:false)!!} {{$event}}
								</div>
								@endforeach
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Mark As Events',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
					</div>
				</div>
			</div>
		</div>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header">In-House Classes</div>
		
					<div class="card-body">
						@if(!empty($customersih))
							<p><strong>Companies marked to show In-House location:</strong><br>
							<span class="help-block">Check items to remove</span></p>
							{!!Form::open(array('route'=>'customerRemoveInHouse'))!!}
							<div style="max-height:150px; border:1px solid #999;overflow-y:auto;" class="p-2 mb-1">
								<div class="row">
									@foreach($customersih as $key=>$customer)
									<div class="col-sm-4">
										{!!Form::checkbox('customers[]',$key)!!} {{$customer}}
									</div>
									@endforeach
								</div>
							</div>
							<div class="form-group">{!!Form::submit('Remove In House',['class'=>'btn btn-primary'])!!}</div>
							{!!Form::close()!!}
							<p>&nbsp;</p>
							<p>&nbsp;</p>
						@endif
						<p><strong>Check companies to add In House location option:</strong></p>
						{!!Form::open(array('route'=>'customerAddInHouse'))!!}
						<div style="max-height:250px; border:1px solid #999; overflow-y:auto;" class="p-2 mb-1">
							<div class="row">
								@foreach($customers as $key=>$customer)
								<div class="col-sm-4">
									{!!Form::checkbox('customers[]',$key)!!} {{$customer}}
								</div>
								@endforeach
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Add In House',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
					</div>
				</div>
			</div>
		</div>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header"><a name="cdform"></a>Class Descriptions</div>
		
					<div class="card-body">
						<div class="row">
							<div class="col-sm-4 mb-4">
								{!!Form::select('classes',$classlist,null,['id'=>'classlist','class'=>'form-control'])!!}
								<div class="help-block" id="classDescriptionMessage"></div>
							</div>
							<div class="col-sm-8">
								{!!Form::open(array('route'=>'classDescription','id'=>'description_form'))!!}
								{!!Form::textarea('classDescription','',['class'=>'form_control','id'=>'classDescription','data-id'=>'0'])!!}<br>
								{!!Form::submit('Save Description',['class'=>'btn btn-primary','style'=>'display:none;','id'=>'classDescriptionSubmit'])!!}
								{!!Form::close()!!}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<p>&nbsp;</p>
		<p>&nbsp;</p>
		<div class="row justify-content-center">
			<div class="col-sm">
				<div class="card">
					<div class="card-header">Fundraising</div>
		
					<div class="card-body">
						{!!Form::open(array('route'=>'fundraising'))!!}
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
									<label for='fund_goal'>Funding Goal:</label>
									{!!Form::text('fund_goal',$settings['donation']->fund_goal,['class'=>'form-control'])!!}
								</div>
								<div class="form-group">
									<label for='fund_goal'>Require check payment amount:</label>
									{!!Form::text('payment_limit',$settings['donation']->payment_limit,['class'=>'form-control'])!!}
								</div>
								<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
								<table class="table table-striped">
									<thead>
										<tr>
											<th>Option</th>
											<th>Available</th>
											<th>Sold</th>
											<th>Price</th>
										</tr>
									</thead>
									<tbody>
										@foreach($sponsoritems as $opt)
										<tr>
											<td>{{$opt->name}}</td>
											<td>{{$opt->qty}}</td>
											<td>{{$opt->sold}}</td>
											<td>${{$opt->price}}</td>
										</tr>
										@endforeach
									</tbody>
								</table>
							</div>
						</div>
						{!!Form::close()!!}
					</div>
				</div>
			</div>
		</div>
	    <p>&nbsp;</p>
	    <p>&nbsp;</p>
	    <div class="row justify-content-center">
	        <div class="col-sm">
	            <div class="card">
	                <div class="card-header">Administrator Email</div>
	
	                <div class="card-body">
						{!!Form::open(array('route'=>'adminEmail'))!!}
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
									<label for='adminemail'>First Administrator Email:</label>
									{!!Form::text('ADMIN_EMAIL',$settings['general']->ADMIN_EMAIL,['class'=>'form-control'])!!}
								</div>
								<div class="form-group">
									<label for='adminemail2'>Second Administrator Email:</label>
									{!!Form::text('ADMIN_EMAIL2',$settings['general']->ADMIN_EMAIL2,['class'=>'form-control'])!!}
								</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
	                </div>
	            </div>
	        </div>
	    </div>
	    <p>&nbsp;</p>
	    <p>&nbsp;</p>
	    <div class="row justify-content-center">
	        <div class="col-sm">
	            <div class="card">
	                <div class="card-header">Authorize.net API</div>
	
	                <div class="card-body">
						{!!Form::open(array('route'=>'adminAPI'))!!}
						<div class="row">
							<div class="col-sm">
								<div class="form-group">
									<label for='adminemail'>API Login:</label>
									{!!Form::text('api_login',$settings['api']->api_login,['class'=>'form-control'])!!}
								</div>
								<div class="form-group">
									<label for='adminemail2'>Transaction Key:</label>
									{!!Form::text('transaction_key',$settings['api']->transaction_key,['class'=>'form-control'])!!}
								</div>
							</div>
						</div>
						<div class="form-group">{!!Form::submit('Submit',['class'=>'btn btn-primary'])!!}</div>
						{!!Form::close()!!}
	                </div>
	            </div>
	        </div>
	    </div>
@endsection

@section('footer')
<script>
	var sections = ['fp_correspondence', 'fp_online', 'fp_trade', 'fp_training', 'fp_event','paymentAgree', 'tradeConfirmation', 'correspondenceConfirmation', 'eventConfirmation', 'onlineConfirmation', 'trainingConfirmation'];
	sections.forEach(function(value) {
		console.log(value);
	    DecoupledEditor
	        .create( document.querySelector( '#'+value+'_content' ) )
	        .then( editor => {
	            const toolbarContainer = document.querySelector( '#'+value+'_toolbar' );
	
	            toolbarContainer.appendChild( editor.ui.view.toolbar.element );
	        } )
	        .catch( error => {
	            console.error( error );
	        } );
	});
	$(document).ready(function() {
		$('#content_form').on('submit',function() {
			$("#fp_correspondence").val($('#fp_correspondence_content').html());
			$("#fp_online").val($('#fp_online_content').html());
			$("#fp_trade").val($('#fp_trade_content').html());
			$("#fp_training").val($('#fp_training_content').html());
			$("#fp_event").val($('#fp_event_content').html());
		});
		$('#paymentAgree_form').on('submit',function() {
			$("#paymentAgree").val($('#paymentAgree_content').html());
		});
		$('#confirmationEmail_form').on('submit',function() {
			$("#tradeConfirmation").val($('#tradeConfirmation_content').html());
			$("#correspondenceConfirmation").val($('#correspondenceConfirmation_content').html());
			$("#eventConfirmation").val($('#eventConfirmation_content').html());
			$("#onlineConfirmation").val($('#onlineConfirmation_content').html());
			$("#trainingConfirmation").val($('#trainingConfirmation_content').html());
		});
		
		$('#classlist').on('change',function() {
			$('#classDescription').data('id',0).val('');
			$("#classDescriptionSubmit").hide(300);
			$("#classDescriptionMessage").text('');
			if(this.value!='0') {
				$.ajaxSetup({
					headers: {
						'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
					}
				});
				$.ajax({
					url: '/ajax/class/description/'+$("#classlist").val(),
					type: 'POST',
					dataType: 'JSON',
					success: function(data) {
						$('#classDescription').data('id',data.id).val(data.description);
						$('#classDescriptionSubmit').show(300);
					},
					error: function(jqXHR, textStatus, errorThrown) {
					}
				});
			}
		});
		$('#description_form').submit(function(e) {
			e.preventDefault();
			if($("classDescription").val()!='') {
				$.ajaxSetup({
					headers: {
						'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
					}
				});
				$.ajax({
					url: '{{route("classDescription")}}',
					type: 'POST',
					data: { id:$("#classDescription").data('id'), description:$("#classDescription").val() },
					dataType: 'HTML',
					success: function(data) {
						$("#classlist").val('0');
						$('#classDescription').data('id',0).val('');
						$("#classDescriptionSubmit").hide(300);
						$("#classDescriptionMessage").text(data);
					},
					error: function(jqXHR, textStatus, errorThrown) {
						$('#classDescription').data('id',0).val('');
						$("#classDescriptionSubmit").hide(300);
						$("#classDescriptionMessage").text('');
					}
				});
			}
		});
	});
</script>
@endsection